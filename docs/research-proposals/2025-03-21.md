---
title: 2025年3月21日
---
## テーマ
コードの時系列変化を考慮した保守性低下の要因分析と改善
## 背景
ソフトウェア開発における長期的な品質維持において、保守性は重要な指標である。リファクタリングに関する実証研究[^1]では、リファクタリングの効果的な適用に必要となる要素がいくつか指摘されている。OpenStackプロジェクトを対象とした研究[^2]では、コードレビューコメントから保守性低下の兆候を捉えている。そしてTDDにおける静的解析ツールの有用性の研究[^3]では、静的解析ツールがリファクタリングを促進し、保守性を改善することが判明している。しかし従来手法は対象が単一時点でのコードに限定されており、時系列変化を伴うコードへの適応が不十分である。
## 目的
本研究はコードの時系列的変化に基づいて保守性低下の要因を分析・改善するアプローチを提案する。メソッドサイズや複雑度の移動平均からの逸脱分析を中心に、従来手法では捉えきれない保守性低下の兆候を特定し、対策を可能にする。具体的には、①コードの時系列構造変化を分析するアルゴリズムの開発、②提案手法を従来手法と比較するための指標の定義・検証を実施する。これにより、保守性の継続的な改善を実現する新たな品質管理プロセスの確立を目指す。
## 新規性・重要性
本研究の新規性は、従来のスナップショット分析から時系列的変化特性の分析への視点の転換にある。既存のコード品質評価手法は、複雑度やサイズといった単一時点でのメトリクスに基づく「スナップショット分析」が主流であり、メトリクス値が許容範囲内である限り問題を検出できない。これに対し本研究では、コードの「変化特性」そのものを分析対象とすることで、絶対値が許容範囲内であっても異常な成長傾向を示すコード領域を早期に特定できる。また、本研究は各プロジェクト固有の進化特性に適応する評価モデルを構築する点でも革新的である。多くの既存研究では全プロジェクトに一律の基準値を適用するが、本研究ではプロジェクト自身の通常進化特性をベースラインとして学習し、そこからの逸脱を検出する。これにより、プロジェクトの規模や成熟度によらず適切な評価が可能になる。さらに、本研究の重要性は保守性低下の早期検出を実現する点にある。従来の限定的な範囲でのリファクタリングではなく、問題が顕在化する前に早期発見・早期対応するプロセスを確立することで、リファクタリング効率の低下を防ぎ、長期的な保守性改善が期待できる。これは特に長期間運用される大規模システムにおいて重要な意義を持つ。産業界における実践的価値としては、本研究の成果をDevOpsに代表されるプロセスに統合することで、品質モニタリングを実現できる点である。これにより、コードレビューの効率化や開発チームの意思決定支援が可能になり、継続的なソフトウェア保守に貢献する。
## 方法論と評価
本研究の手法は以下の3段階で構成される。まず「データ収集と分析基盤の構築」では、規模や成熟度の異なる複数のオープンソースプロジェクト（Ruby, Java, Pythonなど）を対象に、コード解析ツール（例: SonarLint）を用いてメソッドレベルの変更履歴データを収集する。具体的には、活発な開発履歴がある（例: 3年以上）プロジェクトを選定し、コミットごとにメソッド名、複雑度、行数、パラメータ数などの詳細情報を抽出する。また、イシューやプルリクエストの情報も収集し、リファクタリング関連の活動を特定する。次に「保守性低下兆候の検出手法の開発」では、コードメトリクスの時系列データに対して複数の異常検出手法を適用する。具体的には、①移動平均からの逸脱度分析、②累積和による変化点検出、③教師なし学習による多次元的な異常検出を実装する。これらの手法を組み合わせることで、異なる特性の保守性低下兆候を検出できるようにする。特に、メソッドの肥大化や複雑化が急速に進行している箇所や、本来あるべき進化曲線から逸脱している箇所を早期に特定することに重点を置く。最後に「検出手法の評価」では、開発した手法の有効性を多角的に検証する。まず、従来の静的解析やコード品質評価手法との比較実験を行い、同一の問題を検出する際の時間的優位性を分析する。具体的には、従来手法が問題として検出するしきい値に達するまでの期間を測定し、提案手法がどれだけ早期に同様の問題領域を特定できるかを評価する。また、検出された保守性低下兆候と実際のコード変更特性との相関を調査するため、変更頻度、変更規模、変更の連鎖効果、レビュー効率などの観点から分析を行う。これにより、保守性低下の早期検出がもたらす変更時間の削減効果や、潜在的な問題への対応の有効性を定量的に評価し、手法の学術的価値を検証する。
## 補足
### パターン検出に活用できる異常検出アルゴリズム
#### Zスコア
- 概要
	- データポイントが平均からどれだけ標準偏差単位で離れているかを測定
- アルゴリズム
	- データの平均μと標準偏差σを計算
	- それぞれのデータポイントxについて Z = (z - μ) / σ を計算
	- |Z| > しきい値 の場合に、そのポイントを異常と判定
- 特徴
	- 正規分布に従うデータに適している
	- 移動平均と組み合わせることで時系列データに応用できる
	- 平均と標準偏差自体が外れ値の影響を受けるため、外れ値に弱い
#### CUSUM (Cumulative Sum, 累積和)
- 概要
	- 時系列データにおける小さな変化を検出するための逐次分析手法
	- データの累積偏差を追跡し、それが特定のしきい値を超えると変化点として検出
- アルゴリズム
	- 基準値 (通常は平均) からの偏差を計算
	- これらの偏差の上方向と下方向の累積和を追跡
	- 累積和が設定されたしきい値を超えた場合に、変化点 (異常) を検出
- 特徴
	- 時系列データの微小な変化の検出に優れている
	- トレンドの変化点を特定できる
	- パラメーター設定 (感度としきい値) の調整が必要
#### Isolation Forest
- 概要
	- 教師なし学習の異常検出アルゴリズム
	- データを再帰的に分割する決定木を用いて異常値を検出
	- 正常データが多い領域では分割に多くのステップが必要になる一方で、異常値は少ないステップで分離できるという原理に基づいている
- アルゴリズム
	- データセットから複数のサブサンプルを作成
	- それぞれのサブサンプルに対して決定木を構築
		- ランダムな特徴を選び、ランダムな分割点でデータを二分
		- 各点が単独になるか、指定された深さに達するまでに再帰的に分割
	- ポイントの異常スコアは、それを分離するのに必要な平均パス長に基づいて計算
		- パス長が短い = 異常値の可能性が高い
- 特徴
	- 高次元データに効果的
	- 線形時間の複雑性を持つため、計算効率が高い
	- 明示的な密度推定が不要
#### Local Outlier Factor (LOF)
- 概要
	- 密度ベースの、教師なし学習の異常検出アルゴリズム
	- データポイントの局所的な密度を周囲の近傍点の密度と比較することで異常を検出
	- それぞれのポイントに局所的外れ値因子を割り当て、周囲と比べて密度が著しく低いポイントを異常として特定
- アルゴリズム
	- それぞれのデータポイントpについて、k近傍を特定
	- それぞれのポイントの到達可能距離を計算
		- ポイントpからポイントoへの到達可能距離
		- k-distanceは、ポイントとそのポイントとk番目に近いポイントとの距離
	- それぞれのポイントの局所到達可能密度 (LRD) を計算
	- 最終的なLOFスコアを計算
		- LOFスコアが1より大きいほど、異常である可能性が高い
- 特徴
	- 局所的密度の違いに基づいて以上を検出できるため、様々な密度のクラスターが混在するデータセットでも効果的
	- 単一のグローバルなしきい値に依存しない
	- 大規模データセットの場合は計算コストが高い
	- パラメーターkの選択が結果に大きく影響
#### One-Class SVM
- 概要
	- 教師なし学習の異常検出手法
	- 正常データのみを使用して学習し、それ以外を異常として検出
	- データを高次元空間に写像し、データの大部分を含む最小の超平面を見つけることで、その境界外のデータを異常として識別
- アルゴリズム
	- カーネル関数を用いてデータを高次元特徴空間に写像
	- 原点からデータポイントを最大限に分離する超平面を学習
	- 決定関数：f(x) = sgn((w・Φ(x)) - ρ)
	    - Φ(x)は高次元空間への写像
	    - wは超平面の法線ベクトル
	    - ρはバイアス項
	- f(x) < 0 となるポイントを異常と判定
- 特徴
	- 高次元データや複雑な分布を持つデータに効果的
	- パラメーター調整が必要
	- 訓練データに異常値が含まれると性能が低下
	- 大規模データセットの場合は計算コストが高い

## 参考文献
[1]: Microsoft Research, "An Empirical Study of Refactoring Challenges and Benefits at Microsoft", https://www.microsoft.com/en-us/research/publication/an-empirical-study-of-refactoring-challenges-and-benefits-at-microsoft/
[2]: X.Han, A. Tahir, P. Liang, S. Counsell and Y. Luo, "Understanding Code Smell Detection via Code Review: A Study of the OpenStack Community," _2021 IEEE/ACM 29th International Conference on Program Comprehension (ICPC)_
[3]: Simone Romano, Fiorella Zampetti, Maria Teresa Baldassarre, Massimiliano Di Penta, and Giuseppe Scanniello, "Do Static Analysis Tools Affect Software Quality when Using Test-driven Development?", _Proceedings of the 16th ACM / IEEE International Symposium on Empirical Software Engineering and Measurement_