---
title: 2025年3月時点の研究計画
---
## テーマ
コードの進化分析に基づく保守性低下の兆候の検出
## 研究背景と目的
ソフトウェア開発において、コードの保守性は長期的な開発効率と製品品質に直結する重要な要素である。Microsoftの実証研究によれば、適切なリファクタリングは保守性の向上 (30%)、読みやすさの向上 (43%)、バグの減少 (27%)、拡張性の向上と新機能追加の容易化 (27%) などの多岐にわたる利点をもたらす[^1]。

コードレビューやテスト駆動開発と静的解析ツールの組み合わせに関する研究も、本研究の背景として考慮すべき重要な知見を提供している。OpenStackプロジェクトを対象とした研究[^2]では、コードレビューによるコードの臭い検出の効果と限界が明らかにされている。この研究によれば、コードレビューにおいてコードの臭いの検出は (およそ0.4%のレビューコメントのみがコードの臭いに関連するため) 一般的ではなく、特定されたコードの臭いの大部分は重複コード、不適切な命名、デッドコードに集中している。

一方、TDDと静的解析ツールの組み合わせに関する研究[^3]では、IDEに統合された静的解析ツールの使用がTDDプロセスにおけるコード品質に与える影響が調査されている。この研究では、静的解析ツールを使用することで、コードの臭いの削減、技術的負債の削減、コードの理解しやすさの向上といった観点からコード品質が改善されることが示されている。この結果は、複数の実験を通じて統計的に有意な差として確認されており、静的解析ツールがコード品質向上に寄与する可能性を示している。

これらの研究は、コードレビューや静的解析ツールがコード品質の向上に寄与する可能性を示しているが、いくつかの重要な課題も浮き彫りにしている。まず、コードレビューによるコードの臭い検出は、レビュアーの経験や知識に大きく依存し、体系的な品質保証メカニズムとしては不十分である。また、静的解析ツールは特定の種類のコード品質問題を検出するのに効果的である一方で、その効果はツールが検出できる問題の範囲に制限される。さらに、これらのアプローチはいずれも単一時点のコード評価に焦点を当てており、コードの進化過程や変更特性を分析する視点が欠けている。結果として、保守性の継続的な監視や早期介入のための実用的な手段を提供できていない。

本研究では、ソフトウェアの保守性を継続的に確保するための新たな品質管理プロセスの確立を目的とする。従来のプロセスでは、問題が顕在化してから対応するため、効率的な保守性管理が困難であった。これに対し本研究では、コードの時系列的な変化特性を分析して保守性低下の兆候を早期に検出し、リファクタリングを促す品質管理プロセスを提案する。このプロセスでは、保守性を表すメトリクスの変化に着目し、絶対値が許容範囲内であっても潜在的な問題があるコード領域を特定する。そして、開発サイクルの中で段階的な改善を行うことで、大規模リファクタリングの必要性を減少させる新たな品質管理プロセスを実現する。
## 研究手法
本研究では、コードの時系列的な変化を分析し、保守性に影響する構造的な問題を早期に検出する新しいアプローチを採用する。研究手法は以下の3つの段階で構成される。
### データ収集と分析基盤の構築
まず、多様なプロジェクトのリポジトリデータを収集・分析できる基盤を構築する。具体的には、規模・成熟度の異なるオープンソースプロジェクトを対象とする。それぞれのプロジェクトから、コミット履歴、変更内容、イシュー・リファクタリング情報などの時系列データを抽出する。特に、メソッドやクラスレベルでの変更履歴を追跡できるよう、コードの差分解析を行い、コード構造の進化を捉えられるようにすることが重要である。
#### リポジトリの選定基準
研究対象とするリポジトリとしては、分析結果の一般化可能性を高めるために異なる特性をもつプロジェクトを選定する。具体的には、リポジトリをLOC (Lines Of Code) に基づくコード規模ごとに分類し、その中から選出する。また、成熟度として少なくとも3年以上の活発な開発履歴があり、イシュートラッカーの活用度が高いプロジェクトを優先的に選定する。
#### Pydrillerによるコミット履歴データの収集
PyDrillerを活用し、それぞれのリポジトリの全てのコミット履歴を走査してメソッドレベルの変更履歴データを抽出する。具体的には、コミットごとに変更されたファイルを特定し、それぞれのファイル内の修正されたメソッドに関する詳細情報 (メソッド名、複雑度、行数、パタメーター数、変更タイプなど) を収集する。特に、メソッドの複雑度に注目し、これらの複雑度が品質指標として時間経過とともにどのように変化するかを追跡する。
#### GitHub APIとPyGitHubによるイシュー・PRの収集
PyGitHubを用いてそれぞれのプロジェクトのイシューとPR (Pull Request) の詳細情報を収集する。それぞれのイシューとPRについて、タイトル、説明文、ラベル、作成日、クローズ日、コメント履歴などを取得する。特に、リファクタリング関連のラベルが付けられたイシューやPRを特定し、これらがどのコード領域に関連しているかを分析することで、保守性低下の兆候が実際のコード変更特性にどのように影響するかを評価するためのデータとして活用する。
### 保守性低下兆候の検出手法の開発
次に、収集した時系列データに基づく保守性低下の兆候の検出手法を開発する。この手法では、まずそれぞれのコード要素 (メソッド、クラスなど) のサイズや複雑度の時系列データに対して移動平均を計算し、その変化傾向を分析する。急激な逸脱や持続的な悪化といった特性を検出するために、複数の異常検出アルゴリズムを適用し、それらの性能を比較評価する。

さらに、単純なメトリクス変化に加えて、より複雑な構造的劣化特性を定義・検出する。例えば、メソッドの急速な肥大化傾向を特定し、それが保守性とどのように関連するかを分析する。特に、機能追加、コード変更の複雑さ、リファクタリングの頻度などの変更特性と、保守性に関する指標の関係を明らかにすることが重要である。
#### 移動平均からの逸脱度の分析
複雑度などのコードメトリクスの時系列データに対して移動平均分析を行い、通常の進化特性からの逸脱を保守性低下の兆候として検出する。具体的には、メソッドごとに時系列順に並べたメトリクス値に対して、一定期間の移動平均と標準偏差を計算する。その後、現在のメトリクス値が移動平均からどれだけ逸脱しているかをZスコアとして計算し、一定のしきい値を超える場合を異常として検出する。
#### CUSUMアルゴリズムによる変化点検出
コードメトリクスの緩やかな劣化を捉えるために、CUSUMアルゴリズムを使用する。このアルゴリズムは、データの小さな変化でも累積することで有意な変化点を検出できる特徴がある。メソッドごとに時系列順に並べたメトリクス値に対して、平均値からの偏差の累積和を計算し、その値が一定のしきい値を超えた時点を変化点として検出する。具体的には、基準値からの正負の偏差を別々に累積し、どちらかがしきい値を超えた時点を変化点とする。CUSUMの神戸パラメーターとしきい値は、プロジェクトの特性や検出したい変化の大きさに応じて調整する。
#### Isolation Forestによる異常検出
複数のコードメトリクスをく合わせた多次元的な品質劣化特性を検出するために、教師なし学習のアルゴリズムであるIsolation Forestを使用する。このアルゴリズムは、データポイントを分離するのに必要な分割回数に基づいて以上を検出するため、多次元データにも効果的である。具体的には、それぞれのメソッドの複数のメトリクスを特徴量として使用し、これらの組み合わせが通常の特性から逸脱している場合を異常として検出する。
### 検出手法の評価
最後に、開発した検出手法の有効性をコードの保守性の観点から多角的に評価する。まず、従来の静的解析やコード品質評価手法との比較実験を行い、同一の問題を検出する際の時間的優位性を分析する。具体的には、従来手法が問題として検出するしきい値に達するまでの期間を測定し、提案手法がどれだけ早期に同様の問題領域を特定できるかを評価する。
#### 早期検出効果の評価
提案手法の主要な利点として想定している早期検出能力を評価するために、SonarQubeなどの静的解析ツールとの検出タイミングを比較する。具体的な評価手順は以下の通りである。

1. 静的解析ツールが問題と判断する絶対的なしきい値に達するコミットを特定する
2. 提案する時系列手法がその同じ問題を検出するコミットを特定する
3. 両者の検出タイミングの差をコミット数として計測する
4. プロジェクト全体で検出された共通の問題について、この早期検出コミット数の平均を算出する
#### コード変更特性との相関分析
検出された保守性低下の兆候が、コードの変更特性とどのように関連しているかを以下の手順で分析する。

1. 変更頻度分析: 保守性低下兆候が検出された領域とそうでない領域の変更頻度を比較
2. 変更規模分析: 同等の機能変更に必要な修正行数とファイル数の比較
3. 変更の連鎖効果: 一箇所の変更が引き起こす追加的な変更の範囲と数の分析
4. レビュー効率: コードレビューの所要時間や指摘数の比較
## 予想される研究成果
本研究は、従来のコード品質評価研究と比較して、以下の2つの点が異なる。

1つ目は、静的なスナップショット分析から時系列進化分析への転換である。従来の研究では単一時点でのコードの常体を評価するため、問題がしきい値を超えて顕在化した後でしか検出できない。これに対して本研究は、コードの変化特性そのものを分析対象とすることで、絶対的なしきい値に達する前に異常な成長傾向を早期に検出する。この時系列的なアプローチにより、保守性低下の兆候を早期に捉え、介入ができるようになり、コードの構造的品質を維持しながら将来的な機能拡張や変更に対する柔軟性を確保できる。

2つ目は、プロジェクトの特性に適応する評価モデルの構築である。多くの既存研究では、全てのプロジェクトに一律の基準を適用するため、プロジェクトの特性を考慮できていない。これに対して本研究では、各プロジェクトの通常の進化特性をベースラインとして学習し、そこからの逸脱を検出するアプローチを採用する。これにより、プロジェクトの規模や成熟度にかかわらず適切な評価ができるようになる。

本研究から得られる具体的な成果として、以下の点が挙げられる。

まず、定量的な観点では、保守性低下の兆候を静的解析ツールによる検出よりも相当数のコミット分、早く検出できると予測される。これは問題に対処するための時間的余裕を開発者に提供する。また、早期対応によって問題修正に必要なコード変更量を削減できる可能性がある。これは開発効率の向上と技術的負債の蓄積防止に直接寄与する。

学術的な貢献としては、ソフトウェア進化理論に時系列分析の視点を導入することで、コード品質の動的な変化メカニズムの解明に貢献する。また、異常検出アルゴリズムをソフトウェア品質評価に応用する新しい方法論を確立する。

実務的応用の観点では、検出アルゴリズムをCI/CDパイプラインに統合可能なツールとして実装し、継続的な品質モニタリングを実現する。これにより、コードレビューの効率化や開発者の意思決定支援が可能になる。また、検出された保守性低下の兆候に対する具体的な対応策を推奨するガイドラインを作成することで、実際の開発現場での活用を促進する。
## 研究スケジュール
### 4月 - 5月
- 研究対象リポジトリを選定し、PyDriller・GitHub APIを用いてデータ収集システムを構築
### 6月 - 7月
- 品質低下特性を定義し、移動平均からの逸脱度、CUSUMアルゴリズム、Isolation Forestによる異常検出機能を実装
### 8月 - 9月
- 異常検出アルゴリズムの比較実験と相関分析を行い、中間発表資料を作成
### 10月 - 11月
- プロジェクト規模とアルゴリズム性能の関係を分析し、早期検出による保守性向上効果を評価
### 12月 - 1月
- 研究成果の学術的意義と応用可能性を整理し、論文と最終発表資料を作成

## パターン検出に活用できる異常検出アルゴリズム
### Zスコア
- 概要
	- データポイントが平均からどれだけ標準偏差単位で離れているかを測定
- アルゴリズム
	- データの平均μと標準偏差σを計算
	- それぞれのデータポイントxについて Z = (z - μ) / σ を計算
	- |Z| > しきい値 の場合に、そのポイントを異常と判定
- 特徴
	- 正規分布に従うデータに適している
	- 移動平均と組み合わせることで時系列データに応用できる
	- 平均と標準偏差自体が外れ値の影響を受けるため、外れ値に弱い
### CUSUM (Cumulative Sum, 累積和)
- 概要
	- 時系列データにおける小さな変化を検出するための逐次分析手法
	- データの累積偏差を追跡し、それが特定のしきい値を超えると変化点として検出
- アルゴリズム
	- 基準値 (通常は平均) からの偏差を計算
	- これらの偏差の上方向と下方向の累積和を追跡
	- 累積和が設定されたしきい値を超えた場合に、変化点 (異常) を検出
- 特徴
	- 時系列データの微小な変化の検出に優れている
	- トレンドの変化点を特定できる
	- パラメーター設定 (感度としきい値) の調整が必要
### Isolation Forest
- 概要
	- 教師なし学習の異常検出アルゴリズム
	- データを再帰的に分割する決定木を用いて異常値を検出
	- 正常データが多い領域では分割に多くのステップが必要になる一方で、異常値は少ないステップで分離できるという原理に基づいている
- アルゴリズム
	- データセットから複数のサブサンプルを作成
	- それぞれのサブサンプルに対して決定木を構築
		- ランダムな特徴を選び、ランダムな分割点でデータを二分
		- 各点が単独になるか、指定された深さに達するまでに再帰的に分割
	- ポイントの異常スコアは、それを分離するのに必要な平均パス長に基づいて計算
		- パス長が短い = 異常値の可能性が高い
- 特徴
	- 高次元データに効果的
	- 線形時間の複雑性を持つため、計算効率が高い
	- 明示的な密度推定が不要
### Local Outlier Factor (LOF)
- 概要
	- 密度ベースの、教師なし学習の異常検出アルゴリズム
	- データポイントの局所的な密度を周囲の近傍点の密度と比較することで異常を検出
	- それぞれのポイントに局所的外れ値因子を割り当て、周囲と比べて密度が著しく低いポイントを異常として特定
- アルゴリズム
	- それぞれのデータポイントpについて、k近傍を特定
	- それぞれのポイントの到達可能距離を計算
		- ポイントpからポイントoへの到達可能距離
		- k-distanceは、ポイントとそのポイントとk番目に近いポイントとの距離
	- それぞれのポイントの局所到達可能密度 (LRD) を計算
	- 最終的なLOFスコアを計算
		- LOFスコアが1より大きいほど、異常である可能性が高い
- 特徴
	- 局所的密度の違いに基づいて以上を検出できるため、様々な密度のクラスターが混在するデータセットでも効果的
	- 単一のグローバルなしきい値に依存しない
	- 大規模データセットの場合は計算コストが高い
	- パラメーターkの選択が結果に大きく影響
### One-Class SVM
- 概要
	- 教師なし学習の異常検出手法
	- 正常データのみを使用して学習し、それ以外を異常として検出
	- データを高次元空間に写像し、データの大部分を含む最小の超平面を見つけることで、その境界外のデータを異常として識別
- アルゴリズム
	- カーネル関数を用いてデータを高次元特徴空間に写像
	- 原点からデータポイントを最大限に分離する超平面を学習
	- 決定関数：f(x) = sgn((w・Φ(x)) - ρ)
	    - Φ(x)は高次元空間への写像
	    - wは超平面の法線ベクトル
	    - ρはバイアス項
	- f(x) < 0 となるポイントを異常と判定
- 特徴
	- 高次元データや複雑な分布を持つデータに効果的
	- パラメーター調整が必要
	- 訓練データに異常値が含まれると性能が低下
	- 大規模データセットの場合は計算コストが高い
## データ収集・分析に活用できるツール
### PyDriller
- Gitリポジトリのマイニングに特化したPythonフレームワーク
- コミット、変更、開発者情報などを抽出する機能を提供
- メソッドレベルの変更追跡やAST解析ができる
### GrimoireLab
- ソフトウェア開発リポジトリ (GitHub, GitLabなど) からデータを収集し、データ分析・可視化を行える
- リポジトリからデータを取得し、データベースに保存
- メトリクスを計算し、プロジェクトの健全性や進捗状況を監視
### CodeShovel
- コードの変更履歴を詳細に追跡・分析
- 特に、関数やメソッドの進化 (作成、変更、削除など) をリポジトリ全体の履歴を通じて調査するために設計されている
### SonarQube
- コード品質の向上を目的とした静的コード解析ツール
- バグや脆弱性の検出、コーディング規約違反の特定、コードの重複率の計測、コードの複雑度の分析などの機能を提供
### GitHub API + PyGithub
- GitHubリポジトリのメタデータ、イシュー、PRの詳細の取得
- スターやフォークなどのプロジェクト人気度メトリクスの取得
### scikit-learn
- 異常検出アルゴリズムの実装
- 機械学習モデルの構築と評価

[^1]: Microsoft Research, "An Empirical Study of Refactoring Challenges and Benefits at Microsoft", https://www.microsoft.com/en-us/research/publication/an-empirical-study-of-refactoring-challenges-and-benefits-at-microsoft/
[^2]: X. Han, A. Tahir, P. Liang, S. Counsell and Y. Luo, "Understanding Code Smell Detection via Code Review: A Study of the OpenStack Community," _2021 IEEE/ACM 29th International Conference on Program Comprehension (ICPC)_
[^3]: Simone Romano, Fiorella Zampetti, Maria Teresa Baldassarre,  Massimiliano Di Penta, and Giuseppe Scanniello, "Do Static Analysis Tools Affect Software Quality when Using Test-driven Development?", _Proceedings of the 16th ACM / IEEE International Symposium on Empirical Software Engineering and Measurement_
